# Try and add a checksum to a new file
exec integrity -a data.dat
stdout 'data.dat : sha1 : added'

 # Verify the sum created
exec integrity -c data.dat
stdout 'data.dat : sha1 : PASSED'

 # Verify the sum created
exec integrity -v data.dat
stdout 'data.dat : sha1 : 22596363b3de40b06f981fb85d82312e8c0ed511 : PASSED'

# Try and add a sha1 checksum to a new file
exec integrity -a --digest=sha256 data.dat
stdout 'data.dat : sha256 : added'

 # Verify the sum created
exec integrity -v --digest=sha256 data.dat
stdout 'data.dat : sha256 : a948904f2f0f479b8f8197694b30184b0d2ed1c1cd2a1ec0fb85d299a192a447 : PASSED'

# try and add a new checksum on top
exec integrity -a --digest=sha1 data.dat
stdout 'data.dat : sha1 : skipped'

 # Update the file and try and verify
exec bash -c 'echo tiger > data.dat'
exec integrity --digest=sha1 data.dat
stdout 'data.dat : sha1 : FAILED'

exec integrity -v --digest=sha1 data.dat
stdout 'Error checking checksum sha1 on file data.dat ; Calculated checksum and filesystem read checksum differ!'


# try and remove the checksum
exec integrity -d -q --digest=sha1 data.dat
! stdout .

# verify the checksum has been removed - verbose
exec integrity -v --digest=sha1 data.dat
cmp stdout check_missing_checksum_sha1_verbose.txt

# verify the checksum has been removed - normal
exec integrity --digest=sha1 data.dat
cmp stdout check_missing_checksum_sha1.txt

# verify the checksum has been removed - quiet
exec integrity -q --digest=sha1 data.dat
cmp stdout check_missing_checksum_sha1_quiet.txt

# add an ohash checksum
exec integrity -a --digest=oshash data.dat
stdout 'data.dat : oshash : added'

# add a blake2b_256 checksum
exec integrity -a --digest=blake2b_256 data.dat
stdout 'data.dat : blake2b_256 : added'

# check the blake2b_256 checksum
exec integrity -v --digest=blake2b_256 data.dat
stdout 'data.dat : blake2b_256 : 6114a760f9052e0947b6d25dafe7a610b002e5da3f87d2680746c39d2e52ca8c : PASSED'

# add an none checksum, output error
! exec integrity -a --digest=none data.dat

# try to add to non-existing file
! exec integrity -a missing.dat

# Try to recurse into a non-existing dir
! exec integrity -a -r mydir

# Try to recurse into a dir without recurse
exec mkdir mydir
exec integrity -a mydir

# Try to recurse into a dir with no files
exec integrity -a -r mydir

# Disabled test, when running automated tests unable to set env
# Set the digest through the Environment
# exec INTEGRITY_DIGEST=blake2b_256 integrity -a data2.dat
# stdout 'data2.dat : blake2b_256 : added'

# Disabled test, when running automated tests no binary exists
# Code is run with inputs
# Try and add a checksum using a symlinked binary
#exec integrity.sha1 -a data2.dat"
#stdout 'data2.dat : sha1 : added'

# add an phash chdcksum
#exec integrity -a --digest=phash data.dat
#stdout 'data.dat : phash : added'
# FAILING

-- data.dat --
hello world
-- data2.dat --
hello world!!
-- check_missing_checksum_sha1_verbose.txt --
data.dat : sha1 : No checksum, skipped
-- check_missing_checksum_sha1_quiet.txt --
-- check_missing_checksum_sha1.txt --
data.dat : No checksum
-- add_existing_checksum_sha1_verbose.txt --
data.dat : sha1 : We already have a checksum stored, skipped
-- add_existing_checksum_sha1_quiet.txt --
-- add_existing_checksum_sha1.txt --
data.dat : sha1 : skipped
